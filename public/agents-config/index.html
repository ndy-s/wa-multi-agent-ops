<!DOCTYPE html>
<html>
<head>
    <title>Agent Configuration</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>ðŸ§  Agent Configuration</h1>

<div id="config-container"></div>

<button id="saveBtn" class="save-btn">ðŸ’¾ Save Configuration</button>

<script>
// ----------------------------
//   CONFIG SECTION DEFINITION
// ----------------------------
const configSections = [
    {
        title: "Agent Controls",
        id: "agent-controls",
        fields: [
            { key: "ENABLE_CLASSIFIER", label: "Classifier Agent", type: "toggle", readonly: true },
            { key: "ENABLE_API_AGENT", label: "API Agent", type: "toggle" },
            { key: "ENABLE_SQL_AGENT", label: "SQL Agent", type: "toggle" },
        ]
    },
    {
        title: "Authentication",
        fields: [
            { key: "APP_AUTH_USER", label: "Admin Username", type: "text" },
            { key: "APP_AUTH_PASS", label: "Admin Password", type: "password" }
        ]
    },
    {
        title: "API Agent Settings",
        id: "api-agent-section",
        fields: [
            { key: "BASE_API_URL", label: "Base API URL", type: "text" }
        ]
    },
    {
        title: "SQL Agent Settings (Oracle)",
        id: "sql-agent-section",
        fields: [
            { key: "ORACLE_USER", label: "Oracle Username", type: "text" },
            { key: "ORACLE_PASSWORD", label: "Oracle Password", type: "password" },
            { key: "ORACLE_CONNECT_STRING", label: "Connection String", type: "text" }
        ]
    },
    {
        title: "SQLite Base Settings",
        fields: [
            { key: "SQLITE_TYPE", label: "SQLite Mode", type: "select", options: ["local", "cloud"] },
            { key: "SQLITE_URL", label: "Cloud URL", type: "text", placeholder: "sqlite://cloud-url" }
        ]
    },
    {
        title: "LLM Embedding Settings",
        fields: [
            { key: "USE_EMBEDDING", label: "Enable Embedding", type: "toggle" },
            { key: "EMBEDDING_MODEL", label: "Embedding Model", type: "select", options: ["minilm", "gpt3s"] },
            { key: "EMBEDDING_LIMIT_SQL", label: "SQL Limit", type: "number" },
            { key: "EMBEDDING_LIMIT_SCHEMA", label: "Schema Limit", type: "number" },
            { key: "EMBEDDING_LIMIT_API", label: "API Limit", type: "number" }
        ]
    },
    {
        title: "LLM Provider API Keys",
        fields: [
            { key: "OPENAI_API_KEYS", label: "OpenAI API Keys (one per line)", type: "textarea" },
            { key: "GOOGLEAI_API_KEYS", label: "GoogleAI Keys (one per line)", type: "textarea" },
            { key: "OPENROUTER_API_KEYS", label: "OpenRouter Keys (one per line)", type: "textarea" },
            { key: "OPENROUTER_BASE_URL", label: "OpenRouter Base URL", type: "text" }
        ]
    },

    // --------------------------
    //    NEW SECTIONS ADDED
    // --------------------------
    {
        title: "Classifier Mode (Auto)",
        id: "classifier-mode-section",
        fields: [
            { key: "CLASSIFIER_MODE", label: "Mode", type: "text", readonly: true }
        ]
    },
    {
        title: "Manual Classifier Keywords",
        id: "classifier-keywords-section",
        fields: [
            { key: "SQL_KEYWORDS", label: "SQL Keywords (one per line)", type: "textarea" },
            { key: "API_KEYWORDS", label: "API Keywords (one per line)", type: "textarea" }
        ]
    },
    {
        title: "LLM Model Priority",
        id: "model-priority-section",
        fields: [
            { key: "MODEL_PRIORITY", label: "Model Priority (top = highest)", type: "textarea" }
        ]
    }
];

// ----------------------------
//      LOAD CONFIG DATA
// ----------------------------
async function loadConfig() {

    const data = {
        ENABLE_CLASSIFIER: true,
        ENABLE_API_AGENT: true,
        ENABLE_SQL_AGENT: false,
        APP_AUTH_USER: "admin",
        APP_AUTH_PASS: "password",
        BASE_API_URL: "http://localhost:55555/api-dummy",
        SQLITE_TYPE: "local",
        SQLITE_URL: "",
        ORACLE_USER: "",
        ORACLE_PASSWORD: "",
        ORACLE_CONNECT_STRING: "",
        USE_EMBEDDING: true,
        EMBEDDING_LIMIT_SQL: 3,
        EMBEDDING_LIMIT_SCHEMA: 6,
        EMBEDDING_LIMIT_API: 2,
        EMBEDDING_MODEL: "minilm",
        OPENAI_API_KEYS: "",
        GOOGLEAI_API_KEYS: "",
        OPENROUTER_API_KEYS: "",
        OPENROUTER_BASE_URL: "https://openrouter.ai/api/v1",

        SQL_KEYWORDS: "",
        API_KEYWORDS: "",
        MODEL_PRIORITY: "deepseek\ngemini\ngpt",
        CLASSIFIER_MODE: "manual-api"
    };

    const container = document.getElementById("config-container");

    configSections.forEach(section => {
        const card = document.createElement("div");
        card.className = "config-card";
        card.dataset.sectionId = section.id || "";

        card.innerHTML = `
            <div class="config-header">
                <h2>${section.title}</h2>
                <span class="toggle">â–¼</span>
            </div>
            <div class="config-body"></div>
        `;

        const body = card.querySelector(".config-body");

        section.fields.forEach(f => {
            const value = data[f.key] ?? "";
            let inputHtml = "";

            if (f.type === "toggle") {
                inputHtml = `
                    <label class="switch">
                        <input type="checkbox" id="${f.key}" ${value ? "checked" : ""} ${f.readonly ? "disabled" : ""}>
                        <span class="slider"></span>
                    </label>
                `;
            } else if (f.type === "select") {
                inputHtml = `
                    <select id="${f.key}">
                        ${f.options.map(o => `<option value="${o}" ${o === value ? "selected" : ""}>${o}</option>`).join("")}
                    </select>
                `;
            } else if (f.type === "textarea") {
                inputHtml = `<textarea id="${f.key}" rows="3">${value}</textarea>`;
            } else {
                inputHtml = `<input type="text" id="${f.key}" value="${value}" ${f.readonly ? "readonly" : ""}>`;
            }

            body.innerHTML += `
                <div class="config-field">
                    <label>${f.label}</label>
                    ${inputHtml}
                </div>
            `;
        });

        container.appendChild(card);
    });

    attachHandlers();
}

// ----------------------------
//      HANDLERS & LOGIC
// ----------------------------
function attachHandlers() {
    document.querySelectorAll(".config-header").forEach(h => {
        h.addEventListener("click", () =>
            h.parentElement.classList.toggle("collapsed")
        );
    });

    document.getElementById("ENABLE_API_AGENT").addEventListener("change", handleAgentRules);
    document.getElementById("ENABLE_SQL_AGENT").addEventListener("change", handleAgentRules);

    handleAgentRules();
}

function handleAgentRules() {
    const apiOn = document.getElementById("ENABLE_API_AGENT").checked;
    const sqlOn = document.getElementById("ENABLE_SQL_AGENT").checked;

    const classifierEl = document.getElementById("ENABLE_CLASSIFIER");
    const modeEl = document.getElementById("CLASSIFIER_MODE");

    // Classifier auto logic
    classifierEl.disabled = true;

    if (!apiOn && !sqlOn) {
        classifierEl.checked = false;
        modeEl.value = "disabled";
    } else {
        classifierEl.checked = true;

        if (apiOn && sqlOn) modeEl.value = "hybrid";
        else if (apiOn) modeEl.value = "manual-api";
        else if (sqlOn) modeEl.value = "manual-sql";
    }

    // Toggle oracle/API sections
    document.querySelector("[data-section-id='api-agent-section']").style.display = apiOn ? "block" : "none";
    document.querySelector("[data-section-id='sql-agent-section']").style.display = sqlOn ? "block" : "none";
}

// ----------------------------
//      SAVE CONFIG
// ----------------------------
document.getElementById("saveBtn").addEventListener("click", async () => {
    const payload = {};
    document.querySelectorAll("#config-container input, select, textarea").forEach(el => {
        payload[el.id] = el.type === "checkbox" ? el.checked : el.value;
    });

    alert("Configuration saved!");
});

loadConfig();
</script>
</body>
</html>


